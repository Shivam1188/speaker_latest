"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{1963:(e,a,r)=>{r.d(a,{Ay:()=>m,DY:()=>n,Lx:()=>l,_d:()=>i,y4:()=>d});var t=r(1990),s=r(4161),o=r(3464);let l=(0,t.zD)("/login",async(e,a)=>{let{rejectWithValue:r}=a;try{console.log("Auth slice: Calling API login with:",e);let a=await (0,s.$P)("/login",e);return console.log("Auth slice: API response:",a),a}catch(e){var t,o;return console.error("Auth slice: Login error:",e),r((null==(o=e.response)||null==(t=o.data)?void 0:t.detail)||e.message||"Login failed")}}),n=(0,t.zD)("auth/register",async(e,a)=>{let{rejectWithValue:r}=a;try{return await (0,s.$P)("/register",e)}catch(a){var t;let e;return r(o.A.isAxiosError(a)&&(null==(t=a.response)?void 0:t.data)?a.response.data:a instanceof Error?{message:a.message}:{message:String(a)})}}),d=(0,t.zD)("/logout",async(e,a)=>{let{rejectWithValue:r}=a;try{await (0,s.$P)("/logout");return}catch(e){var t,o;return r((null==(o=e.response)||null==(t=o.data)?void 0:t.detail)||"Logout failed")}}),i=(0,t.zD)("/verifyAuth",async(e,a)=>{let{rejectWithValue:r}=a;try{let e=localStorage.getItem("access_token");return console.log(e),!!e}catch(e){var t,s;return r((null==(s=e.response)||null==(t=s.data)?void 0:t.detail)||"Logout failed")}}),c=(0,t.Z0)({name:"auth",initialState:{user:null,tokens:null,username:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null},setTokens:(e,a)=>{e.tokens=a.payload,e.isAuthenticated=!0,localStorage.setItem("access_token",a.payload.access_token)},clearAuth:e=>{e.user=null,e.tokens=null,e.isAuthenticated=!1,e.error=null,localStorage.removeItem("access_token")},setUser:(e,a)=>{e.user=a.payload}},extraReducers:e=>{e.addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,a)=>{e.isLoading=!1,e.user=a.payload.user,e.tokens=a.payload.tokens,e.isAuthenticated=!0,e.error=null,localStorage.setItem("access_token",a.payload.access_token),localStorage.setItem("username",a.payload.username)}).addCase(l.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload,e.isAuthenticated=!1,localStorage.removeItem("access_token")}),e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.isLoading=!1,e.user=a.payload.user,e.tokens=a.payload.tokens,e.isAuthenticated=!1,e.error=null}).addCase(n.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload,e.isAuthenticated=!1,localStorage.removeItem("access_token")}),e.addCase(d.pending,e=>{e.isLoading=!0}).addCase(d.fulfilled,e=>{e.isLoading=!1,e.user=null,e.tokens=null,e.isAuthenticated=!1,e.error=null,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("username")}).addCase(d.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload,e.user=null,e.tokens=null,e.isAuthenticated=!1,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("username")}),e.addCase(i.pending,e=>{e.isLoading=!0}).addCase(i.fulfilled,(e,a)=>{e.isLoading=!1,e.isAuthenticated=a.payload}).addCase(i.rejected,e=>{e.isAuthenticated=!1})}}),{clearError:u,setTokens:g,clearAuth:p,setUser:h}=c.actions,m=c.reducer},1985:(e,a,r)=>{r.d(a,{GV:()=>g,jL:()=>u,yO:()=>c});var t=r(1990),s=r(4540),o=r(1963),l=r(3861),n=r(5432),d=r(4113),i=r(2603);function c(){return(0,t.U1)({reducer:{auth:o.Ay,paragraph:l.Ay,practice:n.Ay,teacher:d.Ay,chat:i.Ay},middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE"]}}),devTools:!1})}c();let u=()=>(0,s.wA)(),g=s.d4},2603:(e,a,r)=>{r.d(a,{Ay:()=>n,SH:()=>l,gJ:()=>s});var t=r(1990);let s=(0,t.zD)("chat/sendMessage",async(e,a)=>{let{rejectWithValue:r}=a;try{let a={question:e.question,subject:e.subject||"",curriculum:e.curriculum||""},r=await fetch("".concat("https://www.edusmartai.com","/chat/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=r.headers.get("content-type");if(!t||!t.includes("application/json")){let e=await r.text();throw Error("Invalid response: ".concat(e.substring(0,100)))}if(!r.ok){let e=await r.json();throw Error(e.detail||"Request failed")}return await r.json()}catch(e){return r(e.message||"An error occurred")}}),o=(0,t.Z0)({name:"chat",initialState:{status:"idle",error:null},reducers:{resetError:e=>{e.error=null}},extraReducers:e=>{e.addCase(s.pending,e=>{e.status="loading",e.error=null}).addCase(s.fulfilled,e=>{e.status="succeeded"}).addCase(s.rejected,(e,a)=>{e.status="failed",e.error=a.payload})}}),{resetError:l}=o.actions,n=o.reducer},3861:(e,a,r)=>{r.d(a,{Ay:()=>d,mU:()=>o});var t=r(1990),s=r(4161);let o=(0,t.zD)("paragraph/generateParagraph",async(e,a)=>{let{rejectWithValue:r}=a;try{let a={student_class:e.class,accent:e.accent,topic:e.topic,mood:e.mood};return(await (0,s.$P)("/generate-prompt",a)).response}catch(e){var t,o;return r((null==(o=e.response)||null==(t=o.data)?void 0:t.message)||"An error occurred")}}),l=(0,t.Z0)({name:"paragraph",initialState:{generatedParagraph:null,isLoading:!1,error:null},reducers:{resetParagraphState:e=>{e.generatedParagraph=null,e.isLoading=!1,e.error=null}},extraReducers:e=>{e.addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.isLoading=!1,e.generatedParagraph=a.payload}).addCase(o.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload||a.error.message})}}),{resetParagraphState:n}=l.actions,d=l.reducer},4113:(e,a,r)=>{r.d(a,{Ay:()=>p,HX:()=>l,dk:()=>d,jN:()=>i,mM:()=>c,t:()=>u});var t=r(1990),s=r(4161);let o={class:null,subject:null,curriculum:null,isLoading:!1,error:null,ocrResults:{},progress:0},l=(0,t.zD)("teacher/processFiles",async(e,a)=>{var r,t;let{getState:o,rejectWithValue:l,dispatch:n}=a;try{let{class:a,subject:t,curriculum:l}=o().teacher,d={};for(let o=0;o<e.length;o++){let i=e[o],c=new FormData;c.append("file",i),c.append("student_class",a||""),c.append("subject",t||""),c.append("curriculum",l||"");let u=Math.floor((o+1)/e.length*100);n(g(u));let p=await (0,s.$P)("/upload/",c);d[i.name]=(null==(r=p.data)?void 0:r.extracted_text)||"No text"}return{results:d}}catch(a){console.error("Upload error:",a);let e="Processing failed";return a.response?e=(null==(t=a.response.data)?void 0:t.detail)||a.response.statusText||"Server error: ".concat(a.response.status):a.message&&(e=a.message),l(e)}}),n=(0,t.Z0)({name:"teacher",initialState:o,reducers:{setClass:(e,a)=>{e.class=a.payload},setSubject:(e,a)=>{e.subject=a.payload},setCurriculum:(e,a)=>{e.curriculum=a.payload},resetUpload:()=>o,setProgress:(e,a)=>{e.progress=a.payload}},extraReducers:e=>{e.addCase(l.pending,e=>{e.isLoading=!0,e.error=null,e.progress=0}).addCase(l.fulfilled,(e,a)=>{e.isLoading=!1,e.ocrResults=a.payload.results,e.progress=100}).addCase(l.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload,e.progress=0})}}),{setClass:d,setSubject:i,setCurriculum:c,resetUpload:u,setProgress:g}=n.actions,p=n.reducer},4161:(e,a,r)=>{r.d(a,{$P:()=>l});class t extends Error{constructor(e,a,r){super(e),this.status=a,this.data=r}}let s=()=>localStorage.getItem("access_token");async function o(e){if(401===e.status)return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("username"),window.location.href="/signin",Promise.reject(new t("Session expired",401));if(!e.ok){let a={};try{a=await e.json()}catch(e){}throw new t(a.detail||a.message||"API Error",e.status,a)}return e.json()}async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=s(),l=new Headers;a instanceof FormData||l.set("Content-Type","application/json"),t&&l.set("Authorization","Bearer ".concat(t)),r.headers&&(r.headers instanceof Headers?Array.from(r.headers.entries()):Array.isArray(r.headers)?r.headers:Object.entries(r.headers)).forEach(e=>{let[a,r]=e;l.append(a,r)});let n=a instanceof FormData?a:JSON.stringify(a),{headers:d,...i}=r;return o(await fetch("".concat("https://www.edusmartai.com").concat(e),{method:"POST",headers:l,body:n,...i}))}},5432:(e,a,r)=>{r.d(a,{Ay:()=>m,Ct:()=>h,K3:()=>n,LN:()=>c,Ww:()=>d,az:()=>s});var t=r(1990);let s=(0,t.zD)("practice/initialize",async(e,a)=>{let{rejectWithValue:r}=a;try{return{paragraph:e}}catch(e){var t,s;return r((null==(s=e.response)||null==(t=s.data)?void 0:t.message)||"Failed to initialize practice")}}),o={isRecording:!1,isAnalyzing:!1,analysisResults:null,error:null,paragraph:"",audioChunks:[],socket:null,mediaRecorder:null,stream:null,sessionId:null},l=(0,t.Z0)({name:"practice",initialState:o,reducers:{startRecording:e=>{e.isRecording=!0},stopRecording:e=>{e.isRecording=!1,e.mediaRecorder&&e.mediaRecorder.stop(),e.stream&&e.stream.getTracks().forEach(e=>e.stop()),e.socket&&e.socket.close()},addAudioChunk:(e,a)=>{e.audioChunks.push(a.payload)},setAnalysisResults:(e,a)=>{e.analysisResults=a.payload,e.isAnalyzing=!1},setSocket:(e,a)=>{e.socket=a.payload},setMediaRecorder:(e,a)=>{e.mediaRecorder=a.payload},setStream:(e,a)=>{e.stream=a.payload},resetPracticeState:e=>{Object.assign(e,o)}},extraReducers:e=>{e.addCase(s.pending,e=>{e.isAnalyzing=!0,e.error=null}).addCase(s.fulfilled,(e,a)=>{e.paragraph=a.payload.paragraph,e.isAnalyzing=!1}).addCase(s.rejected,(e,a)=>{e.isAnalyzing=!1,e.error=a.payload})}}),{startRecording:n,stopRecording:d,addAudioChunk:i,setAnalysisResults:c,setSocket:u,setMediaRecorder:g,setStream:p,resetPracticeState:h}=l.actions,m=l.reducer}}]);